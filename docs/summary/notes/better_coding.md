---
title: 如何梳理代码？
date: 2021-05-01
tags:
 - 干货
categories:
 - front
---

- 写代码应该如何思考
- 观察者模式组织模块
- 职责链模式组织模块

## 什么是程序

- 程序 = 模块 + 模块之间的沟通

## 思考步骤

1. 这个功能的主体对象如何创建

   从如何创建主体对象这个角度我们往创建型设计模式靠拢，而我们熟知的创建型设计模式呢，又有：工厂模式、单例模式、建造者模式。

   从面向对象的角度来说呢，一个功能的实现必然伴随着一个接口、API 或者说类的实现。因为到最终咱们是要去使用这个功能，而实现这个功能的前提就是使用某种设计模式来抽象出来一个类或者说是一个方法。

   那么上面我们说到的几种模式都适用于哪些场景呢？

   首先，我们来说工厂模式，就以 jQuery 为例，类似 jQuery 这种需要**大量创建实例对象**的时候，就需要使用工厂模式来设计。

   而单例模式呢，恰恰相反，它是**保证我们全局只有一个实例化对象**。比如`vue-router、vuex`这两个在全局中必须得保证只有一个实例对象，如果出现多个，那可想而知，整个项目都会出现问题！

   而建造者模式呢，则是不确定，有时候你可以选择全局只创建一个类，但是也不能保证全局只有一个，那这个时候，我们就需要使用建造者模式。它的特性就是会暴露出去一个类，在使用的时候 `new` 这个类，而且这个类很可能是多个子类组成的。典型的例子就是 `Vue2.x` 。

   ::: tip

   建造者模式可以这样来理解，就是我们需要盖一座房子，那这个房子是由不同的部分组成的，要有房梁，地基，窗户，门，墙壁等等，这些不同的结构共同组成了一个完整的房子。

   而我们熟知的 Vue 内部，其实也是由不同的子类和功能模块来组成。

   :::

2. 脱离代码，抽象思考，实现这个功能需要那几步？

   拿到需求之后，先不要考虑如何用代码去实现，而是先考虑，实现这个功能，需要哪几步？等列举好要实现的步骤之后，再回到代码层面。

3. 回到代码，思考实现这几步，需要什么模块

   思考好步骤之后，就对应每个步骤，思考需要哪些模块？需要做哪些模块出来去协助完成。那这个时候就又涉及到了具体程序设计的模块了。

4. 组织模块沟通

   开头说到的两种模式用起来，让代码变得干净整洁，富有可扩展性和维护性，低耦合。

5. 实现模块

6. 质量调优

## 观察者模式是什么

- 目的：当模块之间不方便直接沟通
- 使用方式：通过一个中介，来转发消息

### 异步模块

事件绑定在本质上就是一个异步模块，我们通过 `onclick` 来触发点击事件，并执行相应的代码。

### 原本不在设计之内的模块

那我们来实现一个最简单的观察者模式的例子：

```js
const observe = {
  message: {
    
  },
  // 注册
  register: function (type, fn) {
    this.message[type] = fn;
  },
  // 发布
  fire: function (type) {
    this.message[type]();
  },
  // 删除
  remove: function (type) {
    delete this.message[type];
  }
}
```

这里我们定义一个 `observe` 的对象，里面有一个 `message` 的属性，用来存储值，`register` 用来注册事件，并将对应的方法注册到 `message` 里去，在 `fire` 的时候调用对应的方法即可，最后可以在不使用的时候删除掉对应的属性。

接下来以实现一个越转越快的转盘为例。

