---
title: 前端性能优化
date: 2021-03-16
tags:
 - 优化
categories:
 - front

---

- 从输入 url 到页面展现发生了什么？
- 网络优化
- 浏览器优化

## 从输入 url 到页面展现发生了什么？

*万能面试题*

### 宏观

- DNS
  - 其实也是一个网络协议，把域名解析到 IP 地址。
  - 基于 IP 地址发 TCP 链接。
- TCP
  - 三次握手
  - 四次挥手
  - 慢启动
  - 滑动窗口
  - 超时重发
  - ...
- HTTP / SSL
  - 缓存相关
- 响应解析
- 浏览器渲染
  - how browser works 文章

这些内容每一块的时间加在一起就是从我们输入 url 到页面显示出来的时间。那从优化层面上讲，就是让这块内容更好更稳定的显示出来。

```md
url -> dns 获取 ip -> 建立 tcp -> 发起 http -> 解析响应 -> 浏览器渲染
```

我们大概说下概念，ip 是我们寻常说的寻址，那在它之上有 TCP（可靠协议）和 UDP（不可靠，发出去基本就不管了）。`那 UDP 的应用场景？`，而且我们说的 DNS 其实基于 UDP 来构建的。而 HTTP，FTP还有SSH都是基于 TCP 来做的。

::: tip

`<link rel="dns-prefetch" href="//g.alicdn.com" />`预先解析一下这个url。

:::

### 基于网络协议产生的性能优化方案

### HTTP 解析逻辑

http 基于 TCP，定制了解析的逻辑。

```
method 地址 http/版本
key: value
key: value

body
```

相对于前端而言，以上我们只做了解，我们更需要去关注静态资源的缓存（也是包含在工程化里的重点）。

### 前端是怎么上线代码的？

小应用：开发完毕，html，css，JavaScript 放到 nginx 就可以了。

有数据交互的，开发完毕之后，模板都在 server(smarty, jsp)，静态资源放置在 CDN 上。

::: tip CDN

如果把静态资源都放置在服务器上，那相对服务器位置较远的地方去访问，会因为距离导致的电缆长度加交换机之间的交换延迟，是没有办法去优化解决这个问题的。而将这些资源放置到 CDN 上去之后就可以很大程度的解决这个问题。

:::

在现在我们利用 webpack 自带的 contentHash 来更好的利用缓存。

### 浏览器缓存的逻辑

- 强缓存
- 协商缓存

### 线上静态资源更新方案

contentHash 和 版本号。

### 简单粗暴的优化策略

- 文件加载的更少
  - 缓存，CDN
  - 图片优化
  - 静态文件优化
  - 浏览器优化
  - 文件合并压缩等
- 代码执行的更少

控制异步并发数等等。

### 响应解析

响应报文返回。

在拿到 html 之后，怎么处理？

1. SPA——返回的是一个空的 html，所有逻辑都在 js 里。
2. 同构——首屏渲染加速 + SEO（nuxt, next）
   1. 需要 nodejs 环境，应用首屏，先在 node 里执行渲染一下，然后再返回浏览器。
   2. 后续就是单页的逻辑

最后是浏览器解析 html，然后到 css，再到 js 的执行。

从输入 URL 到页面渲染的时间怎么变短，每一步都有对应的参数指标。

### 浏览器渲染

1. 解析 html (AST) dom tree
2. 解析 css -- CSStree
3. 将以上两部分合并成 render tree
4. 浏览器调用操作系统渲染
5. 重绘回流